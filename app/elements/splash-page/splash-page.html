<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../muuv-spot/muuv-spot.html">
<link rel="import" href="../../bower_components/iron-media-query/iron-media-query.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/firebase-element/firebase-document.html">
<link rel="import" href="../muuv-spot/animated-logo.html">
<link rel="import" href="animated-input.html">

<dom-module id="splash-page">
  <template>
    <style>
      :host {
        overflow:hidden;
        display: block;
        font-family: 'aktivgrotesk';
        @apply(--layout-horizontal);
        @apply(--layout-center);
        min-height: 100%;
        min-width:100%;
      }
      #input{
        --paper-dialog-background-color: transparent;
      }

      #submitBtn{
        border-radius: 64px;
        height: 44px;
        background: var(--accent-color);
      }
      #submitBtn button{
        padding: 4px 4px;
        font-family: 'aktivgrotesk';
        background:transparent;
        color:white;
        border-radius: 64px;
      }
      iron-icon{
        --iron-icon-width:64px;
        --iron-icon-height:64px;
        color: var(--bg-dark-grey);
        margin-bottom: 52px;
      }

      paper-dropdown-menu{
        --paper-dropdown-menu-button:{
          max-width:256px;
        };
        --paper-dropdown-menu-input:{
          font-family: 'aktivgrotesk';
          text-align:center;
          font-size:1.6em;
          line-height: 1.3em;
          color:var(--accent-color);
          --paper-input-container-focus-color: var(--accent-color);
        };
        --paper-input-container-input-color: white;
        --paper-input-container-input:{
            font-size: 30px;
          };
      }

      #arrow.shake{
        animation: shakeup 500ms 1 linear;
        -moz-animation: shakeup 500ms 1 linear;
        -webkit-animation: shakeup 500ms 1 linear;
        -o-animation: shakeup 500ms 1 linear;
      }
      @keyframes shakeup {
         0% {
           -webkit-transform: translateY(12px);
                   transform: translateY(12px);
         }
         50% {
           -webkit-transform: translateY(-6px);
                   transform: translateY(-6px);
         }
         100% {
           -webkit-transform: translateY(0);
                   transform: translateY(0);
         }
       }
       @-webkit-keyframes shakeup {
         0% {
           -webkit-transform: translateY(12px);
         }
         50% {
           -webkit-transform: translateY(-6px);
         }
         100% {
           -webkit-transform: translateY(0);
         }
       }
       #middle{
         height:100%;
       }
       #arrow{
         position: absolute;
         bottom: 5px;
         left: calc(50% - 32px);
       }
       #cornerLogo{
         position: absolute;
         top:0px;
         left: 0px;
         margin-left: 44px;
         margin-top: 44px;
         --logo-width: 251px;
         --logo-height:64px;
       }
       #mobileLogo{
         position: absolute;
         top: 0px;
         left: calc(50% - 147px);
         margin-left: 44px;
         --logo-width: 195px;
         --logo-height:104px;
       }
       #centerLogo{
          --logo-width: 300px;
          --logo-height: 50px;
        }
    </style>
    <!-- MEDIA QUERY -->
    <iron-media-query query="(min-width : 787px)" query-matches="{{isDesktop}}"></iron-media-query>
    <iron-media-query query="(max-width : 786px)" query-matches="{{isMobile}}"></iron-media-query>

    <firebase-document id='firebase' location='https://muuv-splash.firebaseio.com/'
      on-firebase-value='_onFirebaseValue'></firebase-document>

    <template is='dom-if' if='{{isMobile}}'>
      <link rel="import" href="mobile-theme.html">
    </template>
    <template is='dom-if' if='{{isDesktop}}'>
      <link rel="import" href="desktop-theme.html">
    </template>
    <template is='dom-if' if='{{isTwitter}}'>
      <style is='custom-style'>
        muuv-spot:host.center{
           top: calc(50% - 790px/4.4);
        }
      </style>
    </template>
    <!-- SPOTS -->
    <template is='dom-if' if='{{isDesktop}}'>
      <muuv-spot position='topleft'></muuv-spot>
      <muuv-spot position='bottomleft'></muuv-spot>
      <muuv-spot position='topright'></muuv-spot>
      <muuv-spot position='bottomright'></muuv-spot>
      <muuv-spot position='center' is-desktop=[[isDesktop]]></muuv-spot>
    </template>
    <template is='dom-if' if='{{isMobile}}'>
      <muuv-spot position='center' is-mobile='[[isMobile]]'></muuv-spot>
    </template>

    <!-- IRON AJAX -->
    <iron-ajax id='ajax'
      handle-as='json'
      on-response='onSubmitSuccess'
      url='{{mailChimpUrl}}'></iron-ajax>



    <div class='flex'></div>
    <div id='middle' class='layout vertical'>
      <div class='flex'></div>
      <animated-logo id='centerLogo' src='../../images/splash-page/logo.png'></animated-logo>
      <animated-logo  id='cornerLogo' src='../../images/splash-page/logo.png'></animated-logo>
      <template is='dom-if' if='{{isMobile}}'>
        <animated-logo  id='mobileLogo' src='../../images/splash-page/topmobile.svg'></animated-logo>
      </template>
      <animated-input id='input'
        on-submit-signup='_onSubmit'></animated-input>
      <div class='flex'></div>
      <iron-icon id='arrow' icon='expand-less' class='self-center'></iron-icon>
    </div>
    <div class='flex'></div>

  </template>
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'splash-page',
      created: function(){
      },
      ready: function(){
        setInterval(this._jiggleArrow.bind(this),3000);
        // hide inputs
        // this.$.input.hide();
        this.$.cornerLogo.show();
        this.$.centerLogo.hide();
        // this.$.centerLogo.show();
        setTimeout((function(){
          // this.$.centerLogo.hide();
        }).bind(this),2500);
        setTimeout((function(){
          // this.$.input.show();
          if(this.isDesktop){
            // this.$.cornerLogo.show();
          }
        }).bind(this),3500);
        this.isTwitter = navigator.userAgent == 'Mozilla/5.0 (iPhone; CPU iPhone OS 8_2 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Mobile/12D508';

      },
      behaviors: [],
      listeners:{
      },
      properties: {
        firebase: {type: Object, notify: true},
        isTwitter: {type: Boolean, notify: true},
        isMobile: {type: Boolean, notify: true},
        isDesktop: {type: Boolean, notify: true},
        elementName: {type: String, value: 'splash-page', notify: true}
      },
      _onFirebaseValue: function(e,snapshot){
        this.firebase = snapshot;
        console.log('got firebase reference');
      },
      _onScroll: function(e){
        console.log(e.deltaY);
        this.fire('parallax-scroll',e);
      },
      _onTrack: function(e){

      },
      _jiggleArrow: function(){
        console.log('jiggleing....');
        this.toggleClass('shake', true, this.$.arrow);
        setTimeout((function(){
          this.toggleClass('shake', false, this.$.arrow);
        }).bind(this),2000);
      },
      onSubmitSuccess: function(e){
        console.log(e.detail.response)
      },
      _onSubmit: function(e, inp){
        //inp.email, inp.userType;
        this.$.centerLogo.src = '../../images/splash-page/anycityisyours.png';
        this.$.centerLogo.style.display = 'inline';
        this.$.input.style.display = 'none';
        this.firebase.child(inp.userType).ref().push(inp.email);
      }
    });
  })();
  </script>
</dom-module>
